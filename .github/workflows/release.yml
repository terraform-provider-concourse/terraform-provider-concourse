name: release
on:
  push:
    tags:
      - 'u*'

jobs:

  test:  # this is cloned from ci.yml until github actions support job reuse
    name: test
    runs-on: ubuntu-latest
    steps:
      - name: setup
        uses: actions/setup-go@v2
        with:
          go-version: '1.14'

      - name: checkout
        uses: actions/checkout@v1

      - name: ensure-containers-exist
        run: |
          docker-compose up -d && docker-compose down

      - name: integration-tests
        run: sudo make integration-tests

  build:
    name: build
    runs-on: ubuntu-latest
    strategy:
      matrix:
        goos: [ "" ]
    steps:
      - name: setup
        uses: actions/setup-go@v2
        with:
          go-version: '1.14'

      - name: checkout
        uses: actions/checkout@v1

      - name: compile
        run: GOOS="${{ goos }}" make
